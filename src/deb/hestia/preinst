#!/bin/bash

# Run triggers only on updates
if [ ! -e "/usr/local/david/data/users/admin" ]; then
	exit
fi

if [ ! -e "/etc/davidcp/david.conf" ]; then
	mkdir -p /etc/davidcp
	echo -e "# Do not edit this file, will get overwritten on next upgrade, use /etc/davidcp/local.conf instead\n\nexport DAVID='/usr/local/david'\n\n[[ -f /etc/davidcp/local.conf ]] && source /etc/davidcp/local.conf" > /etc/davidcp/david.conf
fi

# Configure apt to retry downloading on error
if [ ! -f /etc/apt/apt.conf.d/80-retries ]; then
	echo "APT::Acquire::Retries \"3\";" > /etc/apt/apt.conf.d/80-retries
fi

# Validate version number and replace if different
HESTIA_V=$(dpkg -s david | grep -i version | awk '{ print $2 }')
